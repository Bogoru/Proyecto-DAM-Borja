"use strict";(globalThis.webpackChunkionic_app_base=globalThis.webpackChunkionic_app_base||[]).push([[186],{186:(e,t,o)=>{o.r(t),o.d(t,{startInputShims:()=>y});var n,i=o(743),r=o(811),a=o(136);!function(e){e.Body="body",e.Ionic="ionic",e.Native="native",e.None="none"}(n||(n={}));const s={getEngine(){var e;return(null===(e=null===a.w||void 0===a.w?void 0:a.w.Capacitor)||void 0===e?void 0:e.isPluginAvailable("Keyboard"))&&(null===a.w||void 0===a.w?void 0:a.w.Capacitor.Plugins.Keyboard)},getResizeMode(){const e=this.getEngine();return e&&e.getResizeMode?e.getResizeMode():Promise.resolve(void 0)}},l=new WeakMap,d=function(e,t,o){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];l.has(e)!==o&&(o?c(e,t,n,i):u(e,t))},c=function(e,t,o){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const i=t.parentNode,r=t.cloneNode(!1);r.classList.add("cloned-input"),r.tabIndex=-1,n&&(r.disabled=!0),i.appendChild(r),l.set(e,r);const a="rtl"===e.ownerDocument.dir?9999:-9999;e.style.pointerEvents="none",t.style.transform=`translate3d(${a}px,${o}px,0) scale(0)`},u=(e,t)=>{const o=l.get(e);o&&(l.delete(e),o.remove()),e.style.pointerEvents="",t.style.transform=""},v="input, textarea, [no-blur], [contenteditable]",f=(e,t,o,n)=>{const i=e.top,r=e.bottom,a=t.top,s=a+15,l=Math.min(t.bottom,n-o)-50-r,d=s-i,c=Math.round(l<0?-l:d>0?-d:0),u=Math.min(c,i-a),v=Math.abs(u)/.3;return{scrollAmount:u,scrollDuration:Math.min(400,Math.max(150,v)),scrollPadding:o,inputSafeY:4-(i-s)}},g="$ionPaddingTimer",m=(e,t,o)=>{const n=e[g];n&&clearTimeout(n),t>0?e.style.setProperty("--keyboard-offset",`${t}px`):e[g]=setTimeout((()=>{e.style.setProperty("--keyboard-offset","0px"),o&&o()}),120)},p=(e,t,o)=>{e.addEventListener("focusout",(()=>{t&&m(t,0,o)}),{once:!0})};let w=0;const h=async function(e,t,o,n,a,s){let l=arguments.length>6&&void 0!==arguments[6]&&arguments[6];if(!o&&!n)return;const c=((e,t,o)=>{var n;const i=null!==(n=e.closest("ion-item,[ion-item]"))&&void 0!==n?n:e;return f(i.getBoundingClientRect(),t.getBoundingClientRect(),o,e.ownerDocument.defaultView.innerHeight)})(e,o||n,a);if(o&&Math.abs(c.scrollAmount)<4)return t.focus(),void(s&&null!==o&&(w+=c.scrollPadding,m(o,w),p(t,o,(()=>w=0))));if(d(e,t,!0,c.inputSafeY,l),t.focus(),(0,r.r)((()=>e.click())),s&&o&&(w+=c.scrollPadding,m(o,w)),"undefined"!==typeof window){let n;const r=async()=>{void 0!==n&&clearTimeout(n),window.removeEventListener("ionKeyboardDidShow",a),window.removeEventListener("ionKeyboardDidShow",r),o&&await(0,i.c)(o,0,c.scrollAmount,c.scrollDuration),d(e,t,!1,c.inputSafeY),t.focus(),s&&p(t,o,(()=>w=0))},a=()=>{window.removeEventListener("ionKeyboardDidShow",a),window.addEventListener("ionKeyboardDidShow",r)};if(o){const e=await(0,i.g)(o),s=e.scrollHeight-e.clientHeight;if(c.scrollAmount>s-e.scrollTop)return"password"===t.type?(c.scrollAmount+=50,window.addEventListener("ionKeyboardDidShow",a)):window.addEventListener("ionKeyboardDidShow",r),void(n=setTimeout(r,1e3))}r()}},y=async(e,t)=>{const o=document,a="ios"===t,l="android"===t,c=e.getNumber("keyboardHeight",290),u=e.getBoolean("scrollAssist",!0),f=e.getBoolean("hideCaretOnScroll",a),g=e.getBoolean("inputBlurring",a),m=e.getBoolean("scrollPadding",!0),p=Array.from(o.querySelectorAll("ion-input, ion-textarea")),w=new WeakMap,y=new WeakMap,b=await s.getResizeMode(),E=async e=>{await new Promise((t=>(0,r.c)(e,t)));const t=e.shadowRoot||e,o=t.querySelector("input")||t.querySelector("textarea"),a=(0,i.a)(e),s=a?null:e.closest("ion-footer");if(!o)return;if(a&&f&&!w.has(e)){const t=((e,t,o)=>{if(!o||!t)return()=>{};const n=o=>{var n;(n=t)===n.getRootNode().activeElement&&d(e,t,o)},i=()=>d(e,t,!1),a=()=>n(!0),s=()=>n(!1);return(0,r.a)(o,"ionScrollStart",a),(0,r.a)(o,"ionScrollEnd",s),t.addEventListener("blur",i),()=>{(0,r.b)(o,"ionScrollStart",a),(0,r.b)(o,"ionScrollEnd",s),t.removeEventListener("blur",i)}})(e,o,a);w.set(e,t)}if(!("date"===o.type||"datetime-local"===o.type)&&(a||s)&&u&&!y.has(e)){const t=function(e,t,o,i,r,a,s){let l=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const d=a&&(void 0===s||s.mode===n.None),c=async()=>{h(e,t,o,i,r,d,l)};return e.addEventListener("focusin",c,!0),()=>{e.removeEventListener("focusin",c,!0)}}(e,o,a,s,c,m,b,l);y.set(e,t)}};g&&(()=>{let e=!0,t=!1;const o=document,n=()=>{t=!0},i=()=>{e=!0},a=n=>{if(t)return void(t=!1);const i=o.activeElement;if(!i)return;if(i.matches(v))return;const r=n.target;r!==i&&(r.matches(v)||r.closest(v)||(e=!1,setTimeout((()=>{e||i.blur()}),50)))};(0,r.a)(o,"ionScrollStart",n),o.addEventListener("focusin",i,!0),o.addEventListener("touchend",a,!1)})();for(const n of p)E(n);o.addEventListener("ionInputDidLoad",(e=>{E(e.detail)})),o.addEventListener("ionInputDidUnload",(e=>{(e=>{if(f){const t=w.get(e);t&&t(),w.delete(e)}if(u){const t=y.get(e);t&&t(),y.delete(e)}})(e.detail)}))}}}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RhdGljL2pzLzE4Ni4xZGI2M2Q4Mi5jaHVuay5qcyIsIm1hcHBpbmdzIjoib0tBT0lBLEUsNEJBQ0osU0FBV0EsR0FDVEEsRUFBcUIsS0FBSSxPQUN6QkEsRUFBc0IsTUFBSSxRQUMxQkEsRUFBdUIsT0FBSSxTQUMzQkEsRUFBcUIsS0FBSSxNQUMxQixDQUxELENBS0dBLElBQW1CQSxFQUFpQixDQUFDLElBQ3hDLE1BQU1DLEVBQVcsQ0FDZkMsWUFDRSxJQUFJQyxFQUNKLE9BQTJFLFFBQWxFQSxFQUFhLE9BQVJDLEVBQUFBLFFBQXdCLElBQVJBLEVBQUFBLE9BQWlCLEVBQVNBLEVBQUFBLEVBQUFBLGlCQUFrQyxJQUFQRCxPQUFnQixFQUFTQSxFQUFHRSxrQkFBa0IsZUFBeUIsT0FBUkQsRUFBQUEsUUFBd0IsSUFBUkEsRUFBQUEsT0FBaUIsRUFBU0EsRUFBQUEsRUFBQUEsVUFBQUEsUUFBQUEsU0FDOUwsRUFDQUUsZ0JBQ0UsTUFBTUMsRUFBU0MsS0FBS04sWUFDcEIsT0FBS0ssR0FBV0EsRUFBT0QsY0FHaEJDLEVBQU9ELGdCQUZMRyxRQUFRQyxhQUFRQyxFQUczQixHQUdJQyxFQUFXLElBQUlDLFFBQ2ZDLEVBQWdCLFNBQUNDLEVBQWFDLEVBQVNDLEdBQW9FLElBQXBEQyxFQUFjQyxVQUFBQyxPQUFBLFFBQUFULElBQUFRLFVBQUEsR0FBQUEsVUFBQSxHQUFHLEVBQUdFLEVBQW1CRixVQUFBQyxPQUFBLFFBQUFULElBQUFRLFVBQUEsSUFBQUEsVUFBQSxHQUM5RlAsRUFBU1UsSUFBSVAsS0FBaUJFLElBRzlCQSxFQUNGTSxFQUFTUixFQUFhQyxFQUFTRSxFQUFnQkcsR0FHL0NHLEVBQVlULEVBQWFDLEdBRTdCLEVBS01PLEVBQVcsU0FBQ1IsRUFBYUMsRUFBU0UsR0FBZ0QsSUFBaENHLEVBQW1CRixVQUFBQyxPQUFBLFFBQUFULElBQUFRLFVBQUEsSUFBQUEsVUFBQSxHQVV6RSxNQUFNTSxFQUFXVCxFQUFRVSxXQUVuQkMsRUFBV1gsRUFBUVksV0FBVSxHQUNuQ0QsRUFBU0UsVUFBVUMsSUFBSSxnQkFDdkJILEVBQVNJLFVBQVksRUFhakJWLElBQ0ZNLEVBQVNLLFVBQVcsR0FFdEJQLEVBQVNRLFlBQVlOLEdBQ3JCZixFQUFTc0IsSUFBSW5CLEVBQWFZLEdBQzFCLE1BQ01RLEVBQWlCLFFBRFhwQixFQUFZcUIsY0FDVEMsSUFBZ0IsTUFBUSxLQUN2Q3RCLEVBQVl1QixNQUFNQyxjQUFnQixPQUNsQ3ZCLEVBQVFzQixNQUFNRSxVQUFhLGVBQWNMLE9BQVFqQixpQkFDbkQsRUFDTU0sRUFBY0EsQ0FBQ1QsRUFBYUMsS0FDaEMsTUFBTXlCLEVBQVE3QixFQUFTOEIsSUFBSTNCLEdBQ3ZCMEIsSUFDRjdCLEVBQVMrQixPQUFPNUIsR0FDaEIwQixFQUFNRyxVQUVSN0IsRUFBWXVCLE1BQU1DLGNBQWdCLEdBQ2xDdkIsRUFBUXNCLE1BQU1FLFVBQVksRUFBRSxFQWlDeEJLLEVBQWdCLGdEQTBEaEJDLEVBQWlCQSxDQUFDQyxFQUFXQyxFQUFhQyxFQUFnQkMsS0FFOUQsTUFBTUMsRUFBV0osRUFBVUssSUFDckJDLEVBQWNOLEVBQVVPLE9BRXhCQyxFQUFpQlAsRUFBWUksSUFHN0JJLEVBQWNELEVBQWlCLEdBRy9CRSxFQUxvQkMsS0FBS0MsSUFBSVgsRUFBWU0sT0FBUUosRUFBaUJELEdBMUY1QyxHQStGY0ksRUFDcENPLEVBQWdCSixFQUFjTCxFQUU5QlUsRUFBc0JILEtBQUtJLE1BQU1MLEVBQW1CLEdBQUtBLEVBQW1CRyxFQUFnQixHQUFLQSxFQUFnQixHQUdqSEcsRUFBZUwsS0FBS0MsSUFBSUUsRUFBcUJWLEVBQVdJLEdBRXhEUyxFQURXTixLQUFLTyxJQUFJRixHQXpCQSxHQTRCMUIsTUFBTyxDQUNMQSxlQUNBRyxlQUhxQlIsS0FBS0MsSUFBSSxJQUFLRCxLQUFLUyxJQUFJLElBQUtILElBSWpESSxjQUFlbkIsRUFDZm9CLFdBQXdDLEdBQTFCbEIsRUFBV0ssR0FDMUIsRUFHR2MsRUFBb0IsbUJBbUJwQkMsRUFBbUJBLENBQUNDLEVBQVdDLEVBQWVDLEtBQ2xELE1BQU1DLEVBQVFILEVBQVVGLEdBQ3BCSyxHQUNGQyxhQUFhRCxHQUVYRixFQUFnQixFQUNsQkQsRUFBVWxDLE1BQU11QyxZQUFZLG9CQUFzQixHQUFFSixPQUdwREQsRUFBVUYsR0FBcUJRLFlBQVcsS0FDeENOLEVBQVVsQyxNQUFNdUMsWUFBWSxvQkFBcUIsT0FDN0NILEdBQ0ZBLEdBQ0YsR0FDQyxJQUNMLEVBWUlLLEVBQWdDQSxDQUFDL0QsRUFBU3dELEVBQVdRLEtBTXpEaEUsRUFBUWlFLGlCQUFpQixZQUxFQyxLQUNyQlYsR0FDRkQsRUFBaUJDLEVBQVcsRUFBR1EsRUFDakMsR0FFdUQsQ0FBRUcsTUFBTSxHQUFPLEVBRzFFLElBQUlDLEVBQWlCLEVBQ3JCLE1Bd0JNQyxFQUFhQyxlQUFPdkUsRUFBYUMsRUFBU3dELEVBQVdlLEVBQVV0QyxFQUFnQnVDLEdBQW9ELElBQS9CQyxFQUFrQnRFLFVBQUFDLE9BQUEsUUFBQVQsSUFBQVEsVUFBQSxJQUFBQSxVQUFBLEdBQzFILElBQUtxRCxJQUFjZSxFQUNqQixPQUVGLE1BQU1HLEVBdkhjQyxFQUFDNUUsRUFBYXlELEVBQVd2QixLQUM3QyxJQUFJOUMsRUFDSixNQUFNeUYsRUFBK0QsUUFBckR6RixFQUFLWSxFQUFZOEUsUUFBUSw4QkFBMkMsSUFBUDFGLEVBQWdCQSxFQUFLWSxFQUNsRyxPQUFPK0IsRUFBZThDLEVBQU9FLHdCQUF5QnRCLEVBQVVzQix3QkFBeUI3QyxFQUFnQmxDLEVBQVlxQixjQUFjMkQsWUFBWUMsWUFDOUksRUFtSGtCTCxDQUFjNUUsRUFBY3lELEdBQWFlLEVBQVd0QyxHQUN2RSxHQUFJdUIsR0FBYWQsS0FBS08sSUFBSXlCLEVBQVczQixjQUFnQixFQWtCbkQsT0FmQS9DLEVBQVFpRixhQVVKVCxHQUFxQyxPQUFkaEIsSUFDekJZLEdBQWtCTSxFQUFXdEIsY0FDN0JHLEVBQWlCQyxFQUFXWSxHQUM1QkwsRUFBOEIvRCxFQUFTd0QsR0FBVyxJQUFPWSxFQUFpQixNQXlCOUUsR0FsQkF0RSxFQUFjQyxFQUFhQyxHQUFTLEVBQU0wRSxFQUFXckIsV0FBWW9CLEdBQ2pFekUsRUFBUWlGLFNBTVJDLEVBQUFBLEVBQUFBLElBQUksSUFBTW5GLEVBQVlvRixVQU9sQlgsR0FBdUJoQixJQUN6QlksR0FBa0JNLEVBQVd0QixjQUM3QkcsRUFBaUJDLEVBQVdZLElBRVIscUJBQVhnQixPQUF3QixDQUNqQyxJQUFJQyxFQUNKLE1BQU1DLEVBQWdCaEIsZUFFUzNFLElBQXpCMEYsR0FDRnpCLGFBQWF5QixHQUVmRCxPQUFPRyxvQkFBb0IscUJBQXNCQyxHQUNqREosT0FBT0csb0JBQW9CLHFCQUFzQkQsR0FFN0M5QixTQUNJaUMsRUFBQUEsRUFBQUEsR0FBY2pDLEVBQVcsRUFBR2tCLEVBQVczQixhQUFjMkIsRUFBV3hCLGdCQUl4RXBELEVBQWNDLEVBQWFDLEdBQVMsRUFBTzBFLEVBQVdyQixZQUV0RHJELEVBQVFpRixRQU1KVCxHQUNGVCxFQUE4Qi9ELEVBQVN3RCxHQUFXLElBQU9ZLEVBQWlCLEdBQzVFLEVBRUlvQixFQUE4QkEsS0FDbENKLE9BQU9HLG9CQUFvQixxQkFBc0JDLEdBQ2pESixPQUFPbkIsaUJBQWlCLHFCQUFzQnFCLEVBQWMsRUFFOUQsR0FBSTlCLEVBQVcsQ0FDYixNQUFNa0MsUUFBaUJDLEVBQUFBLEVBQUFBLEdBQWlCbkMsR0FhbENvQyxFQUFvQkYsRUFBU0csYUFBZUgsRUFBU0ksYUFDM0QsR0FBSXBCLEVBQVczQixhQUFlNkMsRUFBb0JGLEVBQVNLLFVBcUJ6RCxNQWZxQixhQUFqQi9GLEVBQVFnRyxNQUVWdEIsRUFBVzNCLGNBclNTLEdBc1NwQnFDLE9BQU9uQixpQkFBaUIscUJBQXNCdUIsSUFHOUNKLE9BQU9uQixpQkFBaUIscUJBQXNCcUIsUUFRaERELEVBQXVCdkIsV0FBV3dCLEVBQWUsS0FHckQsQ0FDQUEsR0FDRixDQUNGLEVBR01XLEVBQWtCM0IsTUFBTzRCLEVBQVFDLEtBQ3JDLE1BQU1DLEVBQU1DLFNBQ05DLEVBQXFCLFFBQWJILEVBQ1JJLEVBQXlCLFlBQWJKLEVBTVpsRSxFQUFpQmlFLEVBQU9NLFVBQVUsaUJBQWtCLEtBQ3BEQyxFQUFlUCxFQUFPUSxXQUFXLGdCQUFnQixHQUNqREMsRUFBWVQsRUFBT1EsV0FBVyxvQkFBcUJKLEdBQ25ETSxFQUFnQlYsRUFBT1EsV0FBVyxnQkFBaUJKLEdBQ25EbEQsRUFBZ0I4QyxFQUFPUSxXQUFXLGlCQUFpQixHQUNuREcsRUFBU0MsTUFBTUMsS0FBS1gsRUFBSVksaUJBQWlCLDRCQUN6Q0MsRUFBZSxJQUFJcEgsUUFDbkJxSCxFQUFrQixJQUFJckgsUUFTdEJzSCxRQUEyQmxJLEVBQVNLLGdCQUNwQzhILEVBQWdCOUMsZ0JBQ2QsSUFBSTdFLFNBQVNDLElBQVkySCxFQUFBQSxFQUFBQSxHQUFpQnRILEVBQWFMLEtBQzdELE1BQU00SCxFQUFZdkgsRUFBWXdILFlBQWN4SCxFQUN0Q0MsRUFBVXNILEVBQVVFLGNBQWMsVUFBWUYsRUFBVUUsY0FBYyxZQUN0RTlCLEdBQVcrQixFQUFBQSxFQUFBQSxHQUFzQjFILEdBQ2pDd0UsRUFBWW1CLEVBQStDLEtBQXBDM0YsRUFBWThFLFFBQVEsY0FDakQsSUFBSzdFLEVBQ0gsT0FFRixHQUFNMEYsR0FBWWlCLElBQWNNLEVBQWEzRyxJQUFJUCxHQUFjLENBQzdELE1BQU0ySCxFQTVWb0JDLEVBQUM1SCxFQUFhQyxFQUFTMEYsS0FDckQsSUFBS0EsSUFBYTFGLEVBQ2hCLE1BQU8sS0FDQyxFQUdWLE1BQU00SCxFQUFtQkMsSUE5RFJDLFNBK0REOUgsS0E5REM4SCxFQUFNQyxjQUFjQyxlQStEakNsSSxFQUFjQyxFQUFhQyxFQUFTNkgsRUFDdEMsRUFFSUksRUFBU0EsSUFBTW5JLEVBQWNDLEVBQWFDLEdBQVMsR0FDbkQyRyxFQUFZQSxJQUFNaUIsR0FBZ0IsR0FDbENNLEVBQVlBLElBQU1OLEdBQWdCLEdBSXhDLE9BSEEzRCxFQUFBQSxFQUFBQSxHQUFpQnlCLEVBQVUsaUJBQWtCaUIsSUFDN0MxQyxFQUFBQSxFQUFBQSxHQUFpQnlCLEVBQVUsZUFBZ0J3QyxHQUMzQ2xJLEVBQVFpRSxpQkFBaUIsT0FBUWdFLEdBQzFCLE1BQ0wxQyxFQUFBQSxFQUFBQSxHQUFvQkcsRUFBVSxpQkFBa0JpQixJQUNoRHBCLEVBQUFBLEVBQUFBLEdBQW9CRyxFQUFVLGVBQWdCd0MsR0FDOUNsSSxFQUFRdUYsb0JBQW9CLE9BQVEwQyxFQUFPLENBQzVDLEVBdVVnQk4sQ0FBd0I1SCxFQUFhQyxFQUFTMEYsR0FDM0R1QixFQUFhL0YsSUFBSW5CLEVBQWEySCxFQUNoQyxDQVFBLEtBRHFDLFNBQWpCMUgsRUFBUWdHLE1BQW9DLG1CQUFqQmhHLEVBQVFnRyxRQUVsRE4sR0FBY25CLElBQ2pCa0MsSUFDQ1MsRUFBZ0I1RyxJQUFJUCxHQUFjLENBQ25DLE1BQU0ySCxFQW5NZSxTQUFDM0gsRUFBYUMsRUFBU3dELEVBQVdlLEVBQVV0QyxFQUFnQnVDLEVBQXFCMkQsR0FBK0MsSUFBL0IxRCxFQUFrQnRFLFVBQUFDLE9BQUEsUUFBQVQsSUFBQVEsVUFBQSxJQUFBQSxVQUFBLEdBVTVJLE1BQU1pSSxFQUFtQjVELFNBQTJDN0UsSUFBbkJ3SSxHQUFnQ0EsRUFBZUUsT0FBU3JKLEVBQWVzSixNQU1sSEMsRUFBVWpFLFVBQ2RELEVBQVd0RSxFQUFhQyxFQUFTd0QsRUFBV2UsRUFBVXRDLEVBQWdCbUcsRUFBa0IzRCxFQUFtQixFQUc3RyxPQURBMUUsRUFBWWtFLGlCQUFpQixVQUFXc0UsR0FBUyxHQUMxQyxLQUNMeEksRUFBWXdGLG9CQUFvQixVQUFXZ0QsR0FBUyxFQUFLLENBRTdELENBNEttQkMsQ0FBbUJ6SSxFQUFhQyxFQUFTMEYsRUFBVW5CLEVBQVV0QyxFQUFnQm1CLEVBQWUrRCxFQUFvQlosR0FDN0hXLEVBQWdCaEcsSUFBSW5CLEVBQWEySCxFQUNuQyxHQWtCRWQsR0FyV3NCNkIsTUFDMUIsSUFBSUMsR0FBVSxFQUNWQyxHQUFZLEVBQ2hCLE1BQU12QyxFQUFNQyxTQUNOdUMsRUFBV0EsS0FDZkQsR0FBWSxDQUFJLEVBRVpFLEVBQVlBLEtBQ2hCSCxHQUFVLENBQUksRUFFVkksRUFBY0MsSUFFbEIsR0FBSUosRUFFRixZQURBQSxHQUFZLEdBR2QsTUFBTUssRUFBUzVDLEVBQUk0QixjQUNuQixJQUFLZ0IsRUFDSCxPQUdGLEdBQUlBLEVBQU9DLFFBQVFwSCxHQUNqQixPQUdGLE1BQU1xSCxFQUFTSCxFQUFHSSxPQUNkRCxJQUFXRixJQUdYRSxFQUFPRCxRQUFRcEgsSUFBa0JxSCxFQUFPckUsUUFBUWhELEtBR3BENkcsR0FBVSxFQUVWNUUsWUFBVyxLQUNKNEUsR0FDSE0sRUFBT0ksTUFDVCxHQUNDLEtBQUcsR0FFUm5GLEVBQUFBLEVBQUFBLEdBQWlCbUMsRUFBSyxpQkFBa0J3QyxHQUN4Q3hDLEVBQUluQyxpQkFBaUIsVUFBVzRFLEdBQVcsR0FDM0N6QyxFQUFJbkMsaUJBQWlCLFdBQVk2RSxHQUFZLEVBSzVDLEVBdVRDTCxHQUtGLElBQUssTUFBTVgsS0FBU2pCLEVBQ2xCTyxFQUFjVSxHQUdoQjFCLEVBQUluQyxpQkFBaUIsbUJBQXFCOEUsSUFDeEMzQixFQUFjMkIsRUFBR00sT0FBTyxJQUUxQmpELEVBQUluQyxpQkFBaUIscUJBQXVCOEUsSUE3Qm5CaEosS0FDdkIsR0FBSTRHLEVBQVcsQ0FDYixNQUFNMkMsRUFBS3JDLEVBQWF2RixJQUFJM0IsR0FDeEJ1SixHQUNGQSxJQUVGckMsRUFBYXRGLE9BQU81QixFQUN0QixDQUNBLEdBQUkwRyxFQUFjLENBQ2hCLE1BQU02QyxFQUFLcEMsRUFBZ0J4RixJQUFJM0IsR0FDM0J1SixHQUNGQSxJQUVGcEMsRUFBZ0J2RixPQUFPNUIsRUFDekIsR0FnQkF3SixDQUFnQlIsRUFBR00sT0FBTyxHQUN6QixDIiwic291cmNlcyI6WyIuLi9ub2RlX21vZHVsZXMvQGlvbmljL2NvcmUvY29tcG9uZW50cy9pbnB1dC1zaGltcy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIChDKSBJb25pYyBodHRwOi8vaW9uaWNmcmFtZXdvcmsuY29tIC0gTUlUIExpY2Vuc2VcbiAqL1xuaW1wb3J0IHsgZyBhcyBnZXRTY3JvbGxFbGVtZW50LCBjIGFzIHNjcm9sbEJ5UG9pbnQsIGEgYXMgZmluZENsb3Nlc3RJb25Db250ZW50IH0gZnJvbSAnLi9pbmRleDguanMnO1xuaW1wb3J0IHsgYSBhcyBhZGRFdmVudExpc3RlbmVyLCBiIGFzIHJlbW92ZUV2ZW50TGlzdGVuZXIsIHIgYXMgcmFmLCBjIGFzIGNvbXBvbmVudE9uUmVhZHkgfSBmcm9tICcuL2hlbHBlcnMuanMnO1xuaW1wb3J0IHsgdyBhcyB3aW4gfSBmcm9tICcuL2luZGV4NS5qcyc7XG5cbnZhciBLZXlib2FyZFJlc2l6ZTtcbihmdW5jdGlvbiAoS2V5Ym9hcmRSZXNpemUpIHtcbiAgS2V5Ym9hcmRSZXNpemVbXCJCb2R5XCJdID0gXCJib2R5XCI7XG4gIEtleWJvYXJkUmVzaXplW1wiSW9uaWNcIl0gPSBcImlvbmljXCI7XG4gIEtleWJvYXJkUmVzaXplW1wiTmF0aXZlXCJdID0gXCJuYXRpdmVcIjtcbiAgS2V5Ym9hcmRSZXNpemVbXCJOb25lXCJdID0gXCJub25lXCI7XG59KShLZXlib2FyZFJlc2l6ZSB8fCAoS2V5Ym9hcmRSZXNpemUgPSB7fSkpO1xuY29uc3QgS2V5Ym9hcmQgPSB7XG4gIGdldEVuZ2luZSgpIHtcbiAgICB2YXIgX2E7XG4gICAgcmV0dXJuICgoX2EgPSB3aW4gPT09IG51bGwgfHwgd2luID09PSB2b2lkIDAgPyB2b2lkIDAgOiB3aW4uQ2FwYWNpdG9yKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuaXNQbHVnaW5BdmFpbGFibGUoJ0tleWJvYXJkJykpICYmICh3aW4gPT09IG51bGwgfHwgd2luID09PSB2b2lkIDAgPyB2b2lkIDAgOiB3aW4uQ2FwYWNpdG9yLlBsdWdpbnMuS2V5Ym9hcmQpO1xuICB9LFxuICBnZXRSZXNpemVNb2RlKCkge1xuICAgIGNvbnN0IGVuZ2luZSA9IHRoaXMuZ2V0RW5naW5lKCk7XG4gICAgaWYgKCFlbmdpbmUgfHwgIWVuZ2luZS5nZXRSZXNpemVNb2RlKSB7XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHVuZGVmaW5lZCk7XG4gICAgfVxuICAgIHJldHVybiBlbmdpbmUuZ2V0UmVzaXplTW9kZSgpO1xuICB9LFxufTtcblxuY29uc3QgY2xvbmVNYXAgPSBuZXcgV2Vha01hcCgpO1xuY29uc3QgcmVsb2NhdGVJbnB1dCA9IChjb21wb25lbnRFbCwgaW5wdXRFbCwgc2hvdWxkUmVsb2NhdGUsIGlucHV0UmVsYXRpdmVZID0gMCwgZGlzYWJsZWRDbG9uZWRJbnB1dCA9IGZhbHNlKSA9PiB7XG4gIGlmIChjbG9uZU1hcC5oYXMoY29tcG9uZW50RWwpID09PSBzaG91bGRSZWxvY2F0ZSkge1xuICAgIHJldHVybjtcbiAgfVxuICBpZiAoc2hvdWxkUmVsb2NhdGUpIHtcbiAgICBhZGRDbG9uZShjb21wb25lbnRFbCwgaW5wdXRFbCwgaW5wdXRSZWxhdGl2ZVksIGRpc2FibGVkQ2xvbmVkSW5wdXQpO1xuICB9XG4gIGVsc2Uge1xuICAgIHJlbW92ZUNsb25lKGNvbXBvbmVudEVsLCBpbnB1dEVsKTtcbiAgfVxufTtcbi8vIFRPRE8oRlctMjgzMik6IHR5cGVcbmNvbnN0IGlzRm9jdXNlZCA9IChpbnB1dCkgPT4ge1xuICByZXR1cm4gaW5wdXQgPT09IGlucHV0LmdldFJvb3ROb2RlKCkuYWN0aXZlRWxlbWVudDtcbn07XG5jb25zdCBhZGRDbG9uZSA9IChjb21wb25lbnRFbCwgaW5wdXRFbCwgaW5wdXRSZWxhdGl2ZVksIGRpc2FibGVkQ2xvbmVkSW5wdXQgPSBmYWxzZSkgPT4ge1xuICAvLyB0aGlzIGFsbG93cyBmb3IgdGhlIGFjdHVhbCBpbnB1dCB0byByZWNlaXZlIHRoZSBmb2N1cyBmcm9tXG4gIC8vIHRoZSB1c2VyJ3MgdG91Y2ggZXZlbnQsIGJ1dCBiZWZvcmUgaXQgcmVjZWl2ZXMgZm9jdXMsIGl0XG4gIC8vIG1vdmVzIHRoZSBhY3R1YWwgaW5wdXQgdG8gYSBsb2NhdGlvbiB0aGF0IHdpbGwgbm90IHNjcmV3XG4gIC8vIHVwIHRoZSBhcHAncyBsYXlvdXQsIGFuZCBkb2VzIG5vdCBhbGxvdyB0aGUgbmF0aXZlIGJyb3dzZXJcbiAgLy8gdG8gYXR0ZW1wdCB0byBzY3JvbGwgdGhlIGlucHV0IGludG8gcGxhY2UgKG1lc3NpbmcgdXAgaGVhZGVycy9mb290ZXJzKVxuICAvLyB0aGUgY2xvbmVkIGlucHV0IGZpbGxzIHRoZSBhcmVhIG9mIHdoZXJlIG5hdGl2ZSBpbnB1dCBzaG91bGQgYmVcbiAgLy8gd2hpbGUgdGhlIG5hdGl2ZSBpbnB1dCBmYWtlcyBvdXQgdGhlIGJyb3dzZXIgYnkgcmVsb2NhdGluZyBpdHNlbGZcbiAgLy8gYmVmb3JlIGl0IHJlY2VpdmVzIHRoZSBhY3R1YWwgZm9jdXMgZXZlbnRcbiAgLy8gV2UgaGlkZSB0aGUgZm9jdXNlZCBpbnB1dCAod2l0aCB0aGUgdmlzaWJsZSBjYXJldCkgaW52aXNpYmxlIGJ5IG1ha2luZyBpdCBzY2FsZSgwKSxcbiAgY29uc3QgcGFyZW50RWwgPSBpbnB1dEVsLnBhcmVudE5vZGU7XG4gIC8vIERPTSBXUklURVNcbiAgY29uc3QgY2xvbmVkRWwgPSBpbnB1dEVsLmNsb25lTm9kZShmYWxzZSk7XG4gIGNsb25lZEVsLmNsYXNzTGlzdC5hZGQoJ2Nsb25lZC1pbnB1dCcpO1xuICBjbG9uZWRFbC50YWJJbmRleCA9IC0xO1xuICAvKipcbiAgICogTWFraW5nIHRoZSBjbG9uZWQgaW5wdXQgZGlzYWJsZWQgcHJldmVudHNcbiAgICogQ2hyb21lIGZvciBBbmRyb2lkIGZyb20gc3RpbGwgc2Nyb2xsaW5nXG4gICAqIHRoZSBlbnRpcmUgcGFnZSBzaW5jZSB0aGlzIGNsb25lZCBpbnB1dFxuICAgKiB3aWxsIGJyaWVmbHkgYmUgaGlkZGVuIGJ5IHRoZSBrZXlib2FyZFxuICAgKiBldmVuIHRob3VnaCBpdCBpcyBub3QgZm9jdXNlZC5cbiAgICpcbiAgICogVGhpcyBpcyBub3QgbmVlZGVkIG9uIGlPUy4gV2hpbGUgdGhpc1xuICAgKiBkb2VzIG5vdCBjYXVzZSBmdW5jdGlvbmFsIGlzc3VlcyBvbiBpT1MsXG4gICAqIHRoZSBpbnB1dCBzdGlsbCBhcHBlYXJzIHNsaWdodGx5IGRpbW1lZCBldmVuXG4gICAqIGlmIHdlIHNldCBvcGFjaXR5OiAxLlxuICAgKi9cbiAgaWYgKGRpc2FibGVkQ2xvbmVkSW5wdXQpIHtcbiAgICBjbG9uZWRFbC5kaXNhYmxlZCA9IHRydWU7XG4gIH1cbiAgcGFyZW50RWwuYXBwZW5kQ2hpbGQoY2xvbmVkRWwpO1xuICBjbG9uZU1hcC5zZXQoY29tcG9uZW50RWwsIGNsb25lZEVsKTtcbiAgY29uc3QgZG9jID0gY29tcG9uZW50RWwub3duZXJEb2N1bWVudDtcbiAgY29uc3QgdHggPSBkb2MuZGlyID09PSAncnRsJyA/IDk5OTkgOiAtOTk5OTtcbiAgY29tcG9uZW50RWwuc3R5bGUucG9pbnRlckV2ZW50cyA9ICdub25lJztcbiAgaW5wdXRFbC5zdHlsZS50cmFuc2Zvcm0gPSBgdHJhbnNsYXRlM2QoJHt0eH1weCwke2lucHV0UmVsYXRpdmVZfXB4LDApIHNjYWxlKDApYDtcbn07XG5jb25zdCByZW1vdmVDbG9uZSA9IChjb21wb25lbnRFbCwgaW5wdXRFbCkgPT4ge1xuICBjb25zdCBjbG9uZSA9IGNsb25lTWFwLmdldChjb21wb25lbnRFbCk7XG4gIGlmIChjbG9uZSkge1xuICAgIGNsb25lTWFwLmRlbGV0ZShjb21wb25lbnRFbCk7XG4gICAgY2xvbmUucmVtb3ZlKCk7XG4gIH1cbiAgY29tcG9uZW50RWwuc3R5bGUucG9pbnRlckV2ZW50cyA9ICcnO1xuICBpbnB1dEVsLnN0eWxlLnRyYW5zZm9ybSA9ICcnO1xufTtcbi8qKlxuICogRmFjdG9yaW5nIGluIDUwcHggZ2l2ZXMgdXMgc29tZSByb29tXG4gKiBpbiBjYXNlIHRoZSBrZXlib2FyZCBzaG93cyBwYXNzd29yZC9hdXRvZmlsbCBiYXJzXG4gKiBhc3luY2hyb25vdXNseS5cbiAqL1xuY29uc3QgU0NST0xMX0FNT1VOVF9QQURESU5HID0gNTA7XG5cbmNvbnN0IGVuYWJsZUhpZGVDYXJldE9uU2Nyb2xsID0gKGNvbXBvbmVudEVsLCBpbnB1dEVsLCBzY3JvbGxFbCkgPT4ge1xuICBpZiAoIXNjcm9sbEVsIHx8ICFpbnB1dEVsKSB7XG4gICAgcmV0dXJuICgpID0+IHtcbiAgICAgIHJldHVybjtcbiAgICB9O1xuICB9XG4gIGNvbnN0IHNjcm9sbEhpZGVDYXJldCA9IChzaG91bGRIaWRlQ2FyZXQpID0+IHtcbiAgICBpZiAoaXNGb2N1c2VkKGlucHV0RWwpKSB7XG4gICAgICByZWxvY2F0ZUlucHV0KGNvbXBvbmVudEVsLCBpbnB1dEVsLCBzaG91bGRIaWRlQ2FyZXQpO1xuICAgIH1cbiAgfTtcbiAgY29uc3Qgb25CbHVyID0gKCkgPT4gcmVsb2NhdGVJbnB1dChjb21wb25lbnRFbCwgaW5wdXRFbCwgZmFsc2UpO1xuICBjb25zdCBoaWRlQ2FyZXQgPSAoKSA9PiBzY3JvbGxIaWRlQ2FyZXQodHJ1ZSk7XG4gIGNvbnN0IHNob3dDYXJldCA9ICgpID0+IHNjcm9sbEhpZGVDYXJldChmYWxzZSk7XG4gIGFkZEV2ZW50TGlzdGVuZXIoc2Nyb2xsRWwsICdpb25TY3JvbGxTdGFydCcsIGhpZGVDYXJldCk7XG4gIGFkZEV2ZW50TGlzdGVuZXIoc2Nyb2xsRWwsICdpb25TY3JvbGxFbmQnLCBzaG93Q2FyZXQpO1xuICBpbnB1dEVsLmFkZEV2ZW50TGlzdGVuZXIoJ2JsdXInLCBvbkJsdXIpO1xuICByZXR1cm4gKCkgPT4ge1xuICAgIHJlbW92ZUV2ZW50TGlzdGVuZXIoc2Nyb2xsRWwsICdpb25TY3JvbGxTdGFydCcsIGhpZGVDYXJldCk7XG4gICAgcmVtb3ZlRXZlbnRMaXN0ZW5lcihzY3JvbGxFbCwgJ2lvblNjcm9sbEVuZCcsIHNob3dDYXJldCk7XG4gICAgaW5wdXRFbC5yZW1vdmVFdmVudExpc3RlbmVyKCdibHVyJywgb25CbHVyKTtcbiAgfTtcbn07XG5cbmNvbnN0IFNLSVBfU0VMRUNUT1IgPSAnaW5wdXQsIHRleHRhcmVhLCBbbm8tYmx1cl0sIFtjb250ZW50ZWRpdGFibGVdJztcbmNvbnN0IGVuYWJsZUlucHV0Qmx1cnJpbmcgPSAoKSA9PiB7XG4gIGxldCBmb2N1c2VkID0gdHJ1ZTtcbiAgbGV0IGRpZFNjcm9sbCA9IGZhbHNlO1xuICBjb25zdCBkb2MgPSBkb2N1bWVudDtcbiAgY29uc3Qgb25TY3JvbGwgPSAoKSA9PiB7XG4gICAgZGlkU2Nyb2xsID0gdHJ1ZTtcbiAgfTtcbiAgY29uc3Qgb25Gb2N1c2luID0gKCkgPT4ge1xuICAgIGZvY3VzZWQgPSB0cnVlO1xuICB9O1xuICBjb25zdCBvblRvdWNoZW5kID0gKGV2KSA9PiB7XG4gICAgLy8gaWYgYXBwIGRpZCBzY3JvbGwgcmV0dXJuIGVhcmx5XG4gICAgaWYgKGRpZFNjcm9sbCkge1xuICAgICAgZGlkU2Nyb2xsID0gZmFsc2U7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IGFjdGl2ZSA9IGRvYy5hY3RpdmVFbGVtZW50O1xuICAgIGlmICghYWN0aXZlKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIC8vIG9ubHkgYmx1ciBpZiB0aGUgYWN0aXZlIGVsZW1lbnQgaXMgYSB0ZXh0LWlucHV0IG9yIGEgdGV4dGFyZWFcbiAgICBpZiAoYWN0aXZlLm1hdGNoZXMoU0tJUF9TRUxFQ1RPUikpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgLy8gaWYgdGhlIHNlbGVjdGVkIHRhcmdldCBpcyB0aGUgYWN0aXZlIGVsZW1lbnQsIGRvIG5vdCBibHVyXG4gICAgY29uc3QgdGFwcGVkID0gZXYudGFyZ2V0O1xuICAgIGlmICh0YXBwZWQgPT09IGFjdGl2ZSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAodGFwcGVkLm1hdGNoZXMoU0tJUF9TRUxFQ1RPUikgfHwgdGFwcGVkLmNsb3Nlc3QoU0tJUF9TRUxFQ1RPUikpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgZm9jdXNlZCA9IGZhbHNlO1xuICAgIC8vIFRPRE8gRlctMjc5NjogZmluZCBhIGJldHRlciB3YXksIHdoeSA1MG1zP1xuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgaWYgKCFmb2N1c2VkKSB7XG4gICAgICAgIGFjdGl2ZS5ibHVyKCk7XG4gICAgICB9XG4gICAgfSwgNTApO1xuICB9O1xuICBhZGRFdmVudExpc3RlbmVyKGRvYywgJ2lvblNjcm9sbFN0YXJ0Jywgb25TY3JvbGwpO1xuICBkb2MuYWRkRXZlbnRMaXN0ZW5lcignZm9jdXNpbicsIG9uRm9jdXNpbiwgdHJ1ZSk7XG4gIGRvYy5hZGRFdmVudExpc3RlbmVyKCd0b3VjaGVuZCcsIG9uVG91Y2hlbmQsIGZhbHNlKTtcbiAgcmV0dXJuICgpID0+IHtcbiAgICByZW1vdmVFdmVudExpc3RlbmVyKGRvYywgJ2lvblNjcm9sbFN0YXJ0Jywgb25TY3JvbGwsIHRydWUpO1xuICAgIGRvYy5yZW1vdmVFdmVudExpc3RlbmVyKCdmb2N1c2luJywgb25Gb2N1c2luLCB0cnVlKTtcbiAgICBkb2MucmVtb3ZlRXZlbnRMaXN0ZW5lcigndG91Y2hlbmQnLCBvblRvdWNoZW5kLCBmYWxzZSk7XG4gIH07XG59O1xuXG5jb25zdCBTQ1JPTExfQVNTSVNUX1NQRUVEID0gMC4zO1xuY29uc3QgZ2V0U2Nyb2xsRGF0YSA9IChjb21wb25lbnRFbCwgY29udGVudEVsLCBrZXlib2FyZEhlaWdodCkgPT4ge1xuICB2YXIgX2E7XG4gIGNvbnN0IGl0ZW1FbCA9IChfYSA9IGNvbXBvbmVudEVsLmNsb3Nlc3QoJ2lvbi1pdGVtLFtpb24taXRlbV0nKSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogY29tcG9uZW50RWw7XG4gIHJldHVybiBjYWxjU2Nyb2xsRGF0YShpdGVtRWwuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCksIGNvbnRlbnRFbC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSwga2V5Ym9hcmRIZWlnaHQsIGNvbXBvbmVudEVsLm93bmVyRG9jdW1lbnQuZGVmYXVsdFZpZXcuaW5uZXJIZWlnaHQgLy8gVE9ETyhGVy0yODMyKTogdHlwZVxuICApO1xufTtcbmNvbnN0IGNhbGNTY3JvbGxEYXRhID0gKGlucHV0UmVjdCwgY29udGVudFJlY3QsIGtleWJvYXJkSGVpZ2h0LCBwbGF0Zm9ybUhlaWdodCkgPT4ge1xuICAvLyBjb21wdXRlIGlucHV0J3MgWSB2YWx1ZXMgcmVsYXRpdmUgdG8gdGhlIGJvZHlcbiAgY29uc3QgaW5wdXRUb3AgPSBpbnB1dFJlY3QudG9wO1xuICBjb25zdCBpbnB1dEJvdHRvbSA9IGlucHV0UmVjdC5ib3R0b207XG4gIC8vIGNvbXB1dGUgdmlzaWJsZSBhcmVhXG4gIGNvbnN0IHZpc2libGVBcmVhVG9wID0gY29udGVudFJlY3QudG9wO1xuICBjb25zdCB2aXNpYmxlQXJlYUJvdHRvbSA9IE1hdGgubWluKGNvbnRlbnRSZWN0LmJvdHRvbSwgcGxhdGZvcm1IZWlnaHQgLSBrZXlib2FyZEhlaWdodCk7XG4gIC8vIGNvbXB1dGUgc2FmZSBhcmVhXG4gIGNvbnN0IHNhZmVBcmVhVG9wID0gdmlzaWJsZUFyZWFUb3AgKyAxNTtcbiAgY29uc3Qgc2FmZUFyZWFCb3R0b20gPSB2aXNpYmxlQXJlYUJvdHRvbSAtIFNDUk9MTF9BTU9VTlRfUEFERElORztcbiAgLy8gZmlndXJlIG91dCBpZiBlYWNoIGVkZ2Ugb2YgdGhlIGlucHV0IGlzIHdpdGhpbiB0aGUgc2FmZSBhcmVhXG4gIGNvbnN0IGRpc3RhbmNlVG9Cb3R0b20gPSBzYWZlQXJlYUJvdHRvbSAtIGlucHV0Qm90dG9tO1xuICBjb25zdCBkaXN0YW5jZVRvVG9wID0gc2FmZUFyZWFUb3AgLSBpbnB1dFRvcDtcbiAgLy8gZGVzaXJlZFNjcm9sbEFtb3VudCBpcyB0aGUgbmVnYXRlZCBkaXN0YW5jZSB0byB0aGUgc2FmZSBhcmVhIGFjY29yZGluZyB0byBvdXIgY2FsY3VsYXRpb25zLlxuICBjb25zdCBkZXNpcmVkU2Nyb2xsQW1vdW50ID0gTWF0aC5yb3VuZChkaXN0YW5jZVRvQm90dG9tIDwgMCA/IC1kaXN0YW5jZVRvQm90dG9tIDogZGlzdGFuY2VUb1RvcCA+IDAgPyAtZGlzdGFuY2VUb1RvcCA6IDApO1xuICAvLyBvdXIgY2FsY3VsYXRpb25zIG1ha2Ugc29tZSBhc3N1bXB0aW9ucyB0aGF0IGFyZW4ndCBhbHdheXMgdHJ1ZSwgbGlrZSB0aGUga2V5Ym9hcmQgYmVpbmcgY2xvc2VkIHdoZW4gYW4gaW5wdXRcbiAgLy8gZ2V0cyBmb2N1cywgc28gbWFrZSBzdXJlIHdlIGRvbid0IHNjcm9sbCB0aGUgaW5wdXQgYWJvdmUgdGhlIHZpc2libGUgYXJlYVxuICBjb25zdCBzY3JvbGxBbW91bnQgPSBNYXRoLm1pbihkZXNpcmVkU2Nyb2xsQW1vdW50LCBpbnB1dFRvcCAtIHZpc2libGVBcmVhVG9wKTtcbiAgY29uc3QgZGlzdGFuY2UgPSBNYXRoLmFicyhzY3JvbGxBbW91bnQpO1xuICBjb25zdCBkdXJhdGlvbiA9IGRpc3RhbmNlIC8gU0NST0xMX0FTU0lTVF9TUEVFRDtcbiAgY29uc3Qgc2Nyb2xsRHVyYXRpb24gPSBNYXRoLm1pbig0MDAsIE1hdGgubWF4KDE1MCwgZHVyYXRpb24pKTtcbiAgcmV0dXJuIHtcbiAgICBzY3JvbGxBbW91bnQsXG4gICAgc2Nyb2xsRHVyYXRpb24sXG4gICAgc2Nyb2xsUGFkZGluZzoga2V5Ym9hcmRIZWlnaHQsXG4gICAgaW5wdXRTYWZlWTogLShpbnB1dFRvcCAtIHNhZmVBcmVhVG9wKSArIDQsXG4gIH07XG59O1xuXG5jb25zdCBQQURESU5HX1RJTUVSX0tFWSA9ICckaW9uUGFkZGluZ1RpbWVyJztcbi8qKlxuICogU2Nyb2xsIHBhZGRpbmcgYWRkcyBhZGRpdGlvbmFsIHBhZGRpbmcgdG8gdGhlIGJvdHRvbVxuICogb2YgaW9uLWNvbnRlbnQgc28gdGhhdCB0aGVyZSBpcyBlbm91Z2ggc2Nyb2xsIHNwYWNlXG4gKiBmb3IgYW4gaW5wdXQgdG8gYmUgc2Nyb2xsZWQgYWJvdmUgdGhlIGtleWJvYXJkLiBUaGlzXG4gKiBpcyBuZWVkZWQgaW4gZW52aXJvbm1lbnRzIHdoZXJlIHRoZSB3ZWJ2aWV3IGRvZXMgbm90XG4gKiByZXNpemUgd2hlbiB0aGUga2V5Ym9hcmQgb3BlbnMuXG4gKlxuICogRXhhbXBsZTogSWYgYW4gaW5wdXQgYXQgdGhlIGJvdHRvbSBvZiBpb24tY29udGVudCBpc1xuICogZm9jdXNlZCwgdGhlcmUgaXMgbm8gYWRkaXRpb25hbCBzY3JvbGxpbmcgc3BhY2UgYmVsb3dcbiAqIGl0LCBzbyB0aGUgaW5wdXQgY2Fubm90IGJlIHNjcm9sbGVkIGFib3ZlIHRoZSBrZXlib2FyZC5cbiAqIFNjcm9sbCBwYWRkaW5nIGZpeGVzIHRoaXMgYnkgYWRkaW5nIHBhZGRpbmcgZXF1YWwgdG8gdGhlXG4gKiBoZWlnaHQgb2YgdGhlIGtleWJvYXJkIHRvIHRoZSBib3R0b20gb2YgdGhlIGNvbnRlbnQuXG4gKlxuICogQ29tbW9uIGVudmlyb25tZW50cyB3aGVyZSB0aGlzIGlzIG5lZWRlZDpcbiAqIC0gTW9iaWxlIFNhZmFyaTogVGhlIGtleWJvYXJkIG92ZXJsYXlzIHRoZSBjb250ZW50XG4gKiAtIENhcGFjaXRvci9Db3Jkb3ZhIG9uIGlPUzogVGhlIGtleWJvYXJkIG92ZXJsYXlzIHRoZSBjb250ZW50XG4gKiB3aGVuIHRoZSBLZXlib2FyZFJlc2l6ZSBtb2RlIGlzIHNldCB0byAnbm9uZScuXG4gKi9cbmNvbnN0IHNldFNjcm9sbFBhZGRpbmcgPSAoY29udGVudEVsLCBwYWRkaW5nQW1vdW50LCBjbGVhckNhbGxiYWNrKSA9PiB7XG4gIGNvbnN0IHRpbWVyID0gY29udGVudEVsW1BBRERJTkdfVElNRVJfS0VZXTtcbiAgaWYgKHRpbWVyKSB7XG4gICAgY2xlYXJUaW1lb3V0KHRpbWVyKTtcbiAgfVxuICBpZiAocGFkZGluZ0Ftb3VudCA+IDApIHtcbiAgICBjb250ZW50RWwuc3R5bGUuc2V0UHJvcGVydHkoJy0ta2V5Ym9hcmQtb2Zmc2V0JywgYCR7cGFkZGluZ0Ftb3VudH1weGApO1xuICB9XG4gIGVsc2Uge1xuICAgIGNvbnRlbnRFbFtQQURESU5HX1RJTUVSX0tFWV0gPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIGNvbnRlbnRFbC5zdHlsZS5zZXRQcm9wZXJ0eSgnLS1rZXlib2FyZC1vZmZzZXQnLCAnMHB4Jyk7XG4gICAgICBpZiAoY2xlYXJDYWxsYmFjaykge1xuICAgICAgICBjbGVhckNhbGxiYWNrKCk7XG4gICAgICB9XG4gICAgfSwgMTIwKTtcbiAgfVxufTtcbi8qKlxuICogV2hlbiBhbiBpbnB1dCBpcyBhYm91dCB0byBiZSBmb2N1c2VkLFxuICogc2V0IGEgdGltZW91dCB0byBjbGVhciBhbnkgc2Nyb2xsIHBhZGRpbmdcbiAqIG9uIHRoZSBjb250ZW50LiBOb3RlOiBUaGUgY2xlYXJpbmdcbiAqIGlzIGRvbmUgb24gYSB0aW1lb3V0IHNvIHRoYXQgaWYgdXNlcnNcbiAqIGFyZSBtb3ZpbmcgZm9jdXMgZnJvbSBvbmUgaW5wdXQgdG8gdGhlIG5leHRcbiAqIHRoZW4gcmUtYWRkaW5nIHNjcm9sbCBwYWRkaW5nIHRvIHRoZSBuZXdcbiAqIGlucHV0IHdpdGggY2FuY2VsIHRoZSB0aW1lb3V0IHRvIGNsZWFyIHRoZVxuICogc2Nyb2xsIHBhZGRpbmcuXG4gKi9cbmNvbnN0IHNldENsZWFyU2Nyb2xsUGFkZGluZ0xpc3RlbmVyID0gKGlucHV0RWwsIGNvbnRlbnRFbCwgZG9uZUNhbGxiYWNrKSA9PiB7XG4gIGNvbnN0IGNsZWFyU2Nyb2xsUGFkZGluZyA9ICgpID0+IHtcbiAgICBpZiAoY29udGVudEVsKSB7XG4gICAgICBzZXRTY3JvbGxQYWRkaW5nKGNvbnRlbnRFbCwgMCwgZG9uZUNhbGxiYWNrKTtcbiAgICB9XG4gIH07XG4gIGlucHV0RWwuYWRkRXZlbnRMaXN0ZW5lcignZm9jdXNvdXQnLCBjbGVhclNjcm9sbFBhZGRpbmcsIHsgb25jZTogdHJ1ZSB9KTtcbn07XG5cbmxldCBjdXJyZW50UGFkZGluZyA9IDA7XG5jb25zdCBlbmFibGVTY3JvbGxBc3Npc3QgPSAoY29tcG9uZW50RWwsIGlucHV0RWwsIGNvbnRlbnRFbCwgZm9vdGVyRWwsIGtleWJvYXJkSGVpZ2h0LCBlbmFibGVTY3JvbGxQYWRkaW5nLCBrZXlib2FyZFJlc2l6ZSwgZGlzYWJsZUNsb25lZElucHV0ID0gZmFsc2UpID0+IHtcbiAgLyoqXG4gICAqIFNjcm9sbCBwYWRkaW5nIHNob3VsZCBvbmx5IGJlIGFkZGVkIGlmOlxuICAgKiAxLiBUaGUgZ2xvYmFsIHNjcm9sbFBhZGRpbmcgY29uZmlnIG9wdGlvblxuICAgKiBpcyBzZXQgdG8gdHJ1ZS5cbiAgICogMi4gVGhlIG5hdGl2ZSBrZXlib2FyZCByZXNpemUgbW9kZSBpcyBlaXRoZXIgXCJub25lXCJcbiAgICogKGtleWJvYXJkIG92ZXJsYXlzIHdlYnZpZXcpIG9yIHVuZGVmaW5lZCAocmVzaXplXG4gICAqIGluZm9ybWF0aW9uIHVuYXZhaWxhYmxlKVxuICAgKiBSZXNpemUgaW5mbyBpcyBhdmFpbGFibGUgb24gQ2FwYWNpdG9yIDQrXG4gICAqL1xuICBjb25zdCBhZGRTY3JvbGxQYWRkaW5nID0gZW5hYmxlU2Nyb2xsUGFkZGluZyAmJiAoa2V5Ym9hcmRSZXNpemUgPT09IHVuZGVmaW5lZCB8fCBrZXlib2FyZFJlc2l6ZS5tb2RlID09PSBLZXlib2FyZFJlc2l6ZS5Ob25lKTtcbiAgLyoqXG4gICAqIFdoZW4gdGhlIGlucHV0IGlzIGFib3V0IHRvIHJlY2VpdmVcbiAgICogZm9jdXMsIHdlIG5lZWQgdG8gbW92ZSBpdCB0byBwcmV2ZW50XG4gICAqIG1vYmlsZSBTYWZhcmkgZnJvbSBhZGp1c3RpbmcgdGhlIHZpZXdwb3J0LlxuICAgKi9cbiAgY29uc3QgZm9jdXNJbiA9IGFzeW5jICgpID0+IHtcbiAgICBqc1NldEZvY3VzKGNvbXBvbmVudEVsLCBpbnB1dEVsLCBjb250ZW50RWwsIGZvb3RlckVsLCBrZXlib2FyZEhlaWdodCwgYWRkU2Nyb2xsUGFkZGluZywgZGlzYWJsZUNsb25lZElucHV0KTtcbiAgfTtcbiAgY29tcG9uZW50RWwuYWRkRXZlbnRMaXN0ZW5lcignZm9jdXNpbicsIGZvY3VzSW4sIHRydWUpO1xuICByZXR1cm4gKCkgPT4ge1xuICAgIGNvbXBvbmVudEVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2ZvY3VzaW4nLCBmb2N1c0luLCB0cnVlKTtcbiAgfTtcbn07XG5jb25zdCBqc1NldEZvY3VzID0gYXN5bmMgKGNvbXBvbmVudEVsLCBpbnB1dEVsLCBjb250ZW50RWwsIGZvb3RlckVsLCBrZXlib2FyZEhlaWdodCwgZW5hYmxlU2Nyb2xsUGFkZGluZywgZGlzYWJsZUNsb25lZElucHV0ID0gZmFsc2UpID0+IHtcbiAgaWYgKCFjb250ZW50RWwgJiYgIWZvb3RlckVsKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIGNvbnN0IHNjcm9sbERhdGEgPSBnZXRTY3JvbGxEYXRhKGNvbXBvbmVudEVsLCAoY29udGVudEVsIHx8IGZvb3RlckVsKSwga2V5Ym9hcmRIZWlnaHQpO1xuICBpZiAoY29udGVudEVsICYmIE1hdGguYWJzKHNjcm9sbERhdGEuc2Nyb2xsQW1vdW50KSA8IDQpIHtcbiAgICAvLyB0aGUgdGV4dCBpbnB1dCBpcyBpbiBhIHNhZmUgcG9zaXRpb24gdGhhdCBkb2Vzbid0XG4gICAgLy8gcmVxdWlyZSBpdCB0byBiZSBzY3JvbGxlZCBpbnRvIHZpZXcsIGp1c3Qgc2V0IGZvY3VzIG5vd1xuICAgIGlucHV0RWwuZm9jdXMoKTtcbiAgICAvKipcbiAgICAgKiBFdmVuIHRob3VnaCB0aGUgaW5wdXQgZG9lcyBub3QgbmVlZFxuICAgICAqIHNjcm9sbCBhc3Npc3QsIHdlIHNob3VsZCBwcmVzZXJ2ZSB0aGVcbiAgICAgKiB0aGUgc2Nyb2xsIHBhZGRpbmcgYXMgdXNlcnMgY291bGQgYmUgbW92aW5nXG4gICAgICogZm9jdXMgZnJvbSBhbiBpbnB1dCB0aGF0IG5lZWRzIHNjcm9sbCBwYWRkaW5nXG4gICAgICogdG8gYW4gaW5wdXQgdGhhdCBkb2VzIG5vdCBuZWVkIHNjcm9sbCBwYWRkaW5nLlxuICAgICAqIElmIHdlIHJlbW92ZSB0aGUgc2Nyb2xsIHBhZGRpbmcgbm93LCB1c2VycyB3aWxsXG4gICAgICogc2VlIHRoZSBwYWdlIGp1bXAuXG4gICAgICovXG4gICAgaWYgKGVuYWJsZVNjcm9sbFBhZGRpbmcgJiYgY29udGVudEVsICE9PSBudWxsKSB7XG4gICAgICBjdXJyZW50UGFkZGluZyArPSBzY3JvbGxEYXRhLnNjcm9sbFBhZGRpbmc7XG4gICAgICBzZXRTY3JvbGxQYWRkaW5nKGNvbnRlbnRFbCwgY3VycmVudFBhZGRpbmcpO1xuICAgICAgc2V0Q2xlYXJTY3JvbGxQYWRkaW5nTGlzdGVuZXIoaW5wdXRFbCwgY29udGVudEVsLCAoKSA9PiAoY3VycmVudFBhZGRpbmcgPSAwKSk7XG4gICAgfVxuICAgIHJldHVybjtcbiAgfVxuICAvLyB0ZW1wb3JhcmlseSBtb3ZlIHRoZSBmb2N1cyB0byB0aGUgZm9jdXMgaG9sZGVyIHNvIHRoZSBicm93c2VyXG4gIC8vIGRvZXNuJ3QgZnJlYWsgb3V0IHdoaWxlIGl0J3MgdHJ5aW5nIHRvIGdldCB0aGUgaW5wdXQgaW4gcGxhY2VcbiAgLy8gYXQgdGhpcyBwb2ludCB0aGUgbmF0aXZlIHRleHQgaW5wdXQgc3RpbGwgZG9lcyBub3QgaGF2ZSBmb2N1c1xuICByZWxvY2F0ZUlucHV0KGNvbXBvbmVudEVsLCBpbnB1dEVsLCB0cnVlLCBzY3JvbGxEYXRhLmlucHV0U2FmZVksIGRpc2FibGVDbG9uZWRJbnB1dCk7XG4gIGlucHV0RWwuZm9jdXMoKTtcbiAgLyoqXG4gICAqIFJlbG9jYXRpbmcvRm9jdXNpbmcgaW5wdXQgY2F1c2VzIHRoZVxuICAgKiBjbGljayBldmVudCB0byBiZSBjYW5jZWxsZWQsIHNvXG4gICAqIG1hbnVhbGx5IGZpcmUgb25lIGhlcmUuXG4gICAqL1xuICByYWYoKCkgPT4gY29tcG9uZW50RWwuY2xpY2soKSk7XG4gIC8qKlxuICAgKiBJZiBlbmFibGVkLCB3ZSBjYW4gYWRkIHNjcm9sbCBwYWRkaW5nIHRvXG4gICAqIHRoZSBib3R0b20gb2YgdGhlIGNvbnRlbnQgc28gdGhhdCBzY3JvbGwgYXNzaXN0XG4gICAqIGhhcyBlbm91Z2ggcm9vbSB0byBzY3JvbGwgdGhlIGlucHV0IGFib3ZlXG4gICAqIHRoZSBrZXlib2FyZC5cbiAgICovXG4gIGlmIChlbmFibGVTY3JvbGxQYWRkaW5nICYmIGNvbnRlbnRFbCkge1xuICAgIGN1cnJlbnRQYWRkaW5nICs9IHNjcm9sbERhdGEuc2Nyb2xsUGFkZGluZztcbiAgICBzZXRTY3JvbGxQYWRkaW5nKGNvbnRlbnRFbCwgY3VycmVudFBhZGRpbmcpO1xuICB9XG4gIGlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJykge1xuICAgIGxldCBzY3JvbGxDb250ZW50VGltZW91dDtcbiAgICBjb25zdCBzY3JvbGxDb250ZW50ID0gYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gY2xlYW4gdXAgbGlzdGVuZXJzIGFuZCB0aW1lb3V0c1xuICAgICAgaWYgKHNjcm9sbENvbnRlbnRUaW1lb3V0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgY2xlYXJUaW1lb3V0KHNjcm9sbENvbnRlbnRUaW1lb3V0KTtcbiAgICAgIH1cbiAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdpb25LZXlib2FyZERpZFNob3cnLCBkb3VibGVLZXlib2FyZEV2ZW50TGlzdGVuZXIpO1xuICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2lvbktleWJvYXJkRGlkU2hvdycsIHNjcm9sbENvbnRlbnQpO1xuICAgICAgLy8gc2Nyb2xsIHRoZSBpbnB1dCBpbnRvIHBsYWNlXG4gICAgICBpZiAoY29udGVudEVsKSB7XG4gICAgICAgIGF3YWl0IHNjcm9sbEJ5UG9pbnQoY29udGVudEVsLCAwLCBzY3JvbGxEYXRhLnNjcm9sbEFtb3VudCwgc2Nyb2xsRGF0YS5zY3JvbGxEdXJhdGlvbik7XG4gICAgICB9XG4gICAgICAvLyB0aGUgc2Nyb2xsIHZpZXcgaXMgaW4gdGhlIGNvcnJlY3QgcG9zaXRpb24gbm93XG4gICAgICAvLyBnaXZlIHRoZSBuYXRpdmUgdGV4dCBpbnB1dCBmb2N1c1xuICAgICAgcmVsb2NhdGVJbnB1dChjb21wb25lbnRFbCwgaW5wdXRFbCwgZmFsc2UsIHNjcm9sbERhdGEuaW5wdXRTYWZlWSk7XG4gICAgICAvLyBlbnN1cmUgdGhpcyBpcyB0aGUgZm9jdXNlZCBpbnB1dFxuICAgICAgaW5wdXRFbC5mb2N1cygpO1xuICAgICAgLyoqXG4gICAgICAgKiBXaGVuIHRoZSBpbnB1dCBpcyBhYm91dCB0byBiZSBibHVycmVkXG4gICAgICAgKiB3ZSBzaG91bGQgc2V0IGEgdGltZW91dCB0byByZW1vdmVcbiAgICAgICAqIGFueSBzY3JvbGwgcGFkZGluZy5cbiAgICAgICAqL1xuICAgICAgaWYgKGVuYWJsZVNjcm9sbFBhZGRpbmcpIHtcbiAgICAgICAgc2V0Q2xlYXJTY3JvbGxQYWRkaW5nTGlzdGVuZXIoaW5wdXRFbCwgY29udGVudEVsLCAoKSA9PiAoY3VycmVudFBhZGRpbmcgPSAwKSk7XG4gICAgICB9XG4gICAgfTtcbiAgICBjb25zdCBkb3VibGVLZXlib2FyZEV2ZW50TGlzdGVuZXIgPSAoKSA9PiB7XG4gICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcignaW9uS2V5Ym9hcmREaWRTaG93JywgZG91YmxlS2V5Ym9hcmRFdmVudExpc3RlbmVyKTtcbiAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdpb25LZXlib2FyZERpZFNob3cnLCBzY3JvbGxDb250ZW50KTtcbiAgICB9O1xuICAgIGlmIChjb250ZW50RWwpIHtcbiAgICAgIGNvbnN0IHNjcm9sbEVsID0gYXdhaXQgZ2V0U2Nyb2xsRWxlbWVudChjb250ZW50RWwpO1xuICAgICAgLyoqXG4gICAgICAgKiBzY3JvbGxEYXRhIHdpbGwgb25seSBjb25zaWRlciB0aGUgYW1vdW50IHdlIG5lZWRcbiAgICAgICAqIHRvIHNjcm9sbCBpbiBvcmRlciB0byBwcm9wZXJseSBicmluZyB0aGUgaW5wdXRcbiAgICAgICAqIGludG8gdmlldy4gSXQgd2lsbCBub3QgY29uc2lkZXIgdGhlIGFtb3VudFxuICAgICAgICogd2UgY2FuIHNjcm9sbCBpbiB0aGUgY29udGVudCBlbGVtZW50LlxuICAgICAgICogQXMgYSByZXN1bHQsIHNjcm9sbERhdGEgbWF5IHJlcXVlc3QgYSBncmVhdGVyXG4gICAgICAgKiBzY3JvbGwgcG9zaXRpb24gdGhhbiBpcyBjdXJyZW50bHkgYXZhaWxhYmxlXG4gICAgICAgKiBpbiB0aGUgRE9NLiBJZiB0aGlzIGlzIHRoZSBjYXNlLCB3ZSBuZWVkIHRvXG4gICAgICAgKiB3YWl0IGZvciB0aGUgd2VidmlldyB0byByZXNpemUvdGhlIGtleWJvYXJkXG4gICAgICAgKiB0byBzaG93IGluIG9yZGVyIGZvciBhZGRpdGlvbmFsIHNjcm9sbFxuICAgICAgICogYmFuZHdpZHRoIHRvIGJlY29tZSBhdmFpbGFibGUuXG4gICAgICAgKi9cbiAgICAgIGNvbnN0IHRvdGFsU2Nyb2xsQW1vdW50ID0gc2Nyb2xsRWwuc2Nyb2xsSGVpZ2h0IC0gc2Nyb2xsRWwuY2xpZW50SGVpZ2h0O1xuICAgICAgaWYgKHNjcm9sbERhdGEuc2Nyb2xsQW1vdW50ID4gdG90YWxTY3JvbGxBbW91bnQgLSBzY3JvbGxFbC5zY3JvbGxUb3ApIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIE9uIGlPUyBkZXZpY2VzLCB0aGUgc3lzdGVtIHdpbGwgc2hvdyBhIFwiUGFzc3dvcmRzXCIgYmFyIGFib3ZlIHRoZSBrZXlib2FyZFxuICAgICAgICAgKiBhZnRlciB0aGUgaW5pdGlhbCBrZXlib2FyZCBpcyBzaG93bi4gVGhpcyBwcmV2ZW50cyB0aGUgd2VidmlldyBmcm9tIHJlc2l6aW5nXG4gICAgICAgICAqIHVudGlsIHRoZSBcIlBhc3N3b3Jkc1wiIGJhciBpcyBzaG93biwgc28gd2UgbmVlZCB0byB3YWl0IGZvciB0aGF0IHRvIGhhcHBlbiBmaXJzdC5cbiAgICAgICAgICovXG4gICAgICAgIGlmIChpbnB1dEVsLnR5cGUgPT09ICdwYXNzd29yZCcpIHtcbiAgICAgICAgICAvLyBBZGQgNTBweCB0byBhY2NvdW50IGZvciB0aGUgXCJQYXNzd29yZHNcIiBiYXJcbiAgICAgICAgICBzY3JvbGxEYXRhLnNjcm9sbEFtb3VudCArPSBTQ1JPTExfQU1PVU5UX1BBRERJTkc7XG4gICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2lvbktleWJvYXJkRGlkU2hvdycsIGRvdWJsZUtleWJvYXJkRXZlbnRMaXN0ZW5lcik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2lvbktleWJvYXJkRGlkU2hvdycsIHNjcm9sbENvbnRlbnQpO1xuICAgICAgICB9XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGlzIHNob3VsZCBvbmx5IGZpcmUgaW4gMiBpbnN0YW5jZXM6XG4gICAgICAgICAqIDEuIFRoZSBhcHAgaXMgdmVyeSBzbG93LlxuICAgICAgICAgKiAyLiBUaGUgYXBwIGlzIHJ1bm5pbmcgaW4gYSBicm93c2VyIG9uIGFuIG9sZCBPU1xuICAgICAgICAgKiB0aGF0IGRvZXMgbm90IHN1cHBvcnQgSW9uaWMgS2V5Ym9hcmQgRXZlbnRzXG4gICAgICAgICAqL1xuICAgICAgICBzY3JvbGxDb250ZW50VGltZW91dCA9IHNldFRpbWVvdXQoc2Nyb2xsQ29udGVudCwgMTAwMCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICB9XG4gICAgc2Nyb2xsQ29udGVudCgpO1xuICB9XG59O1xuXG5jb25zdCBJTlBVVF9CTFVSUklORyA9IHRydWU7XG5jb25zdCBzdGFydElucHV0U2hpbXMgPSBhc3luYyAoY29uZmlnLCBwbGF0Zm9ybSkgPT4ge1xuICBjb25zdCBkb2MgPSBkb2N1bWVudDtcbiAgY29uc3QgaXNJT1MgPSBwbGF0Zm9ybSA9PT0gJ2lvcyc7XG4gIGNvbnN0IGlzQW5kcm9pZCA9IHBsYXRmb3JtID09PSAnYW5kcm9pZCc7XG4gIC8qKlxuICAgKiBIaWRlIENhcmV0IGFuZCBJbnB1dCBCbHVycmluZyBhcmUgbmVlZGVkIG9uIGlPUy5cbiAgICogU2Nyb2xsIEFzc2lzdCBhbmQgU2Nyb2xsIFBhZGRpbmcgYXJlIG5lZWRlZCBvbiBpT1MgYW5kIEFuZHJvaWRcbiAgICogd2l0aCBDaHJvbWUgd2ViIGJyb3dzZXIgKG5vdCBDaHJvbWUgd2VidmlldykuXG4gICAqL1xuICBjb25zdCBrZXlib2FyZEhlaWdodCA9IGNvbmZpZy5nZXROdW1iZXIoJ2tleWJvYXJkSGVpZ2h0JywgMjkwKTtcbiAgY29uc3Qgc2Nyb2xsQXNzaXN0ID0gY29uZmlnLmdldEJvb2xlYW4oJ3Njcm9sbEFzc2lzdCcsIHRydWUpO1xuICBjb25zdCBoaWRlQ2FyZXQgPSBjb25maWcuZ2V0Qm9vbGVhbignaGlkZUNhcmV0T25TY3JvbGwnLCBpc0lPUyk7XG4gIGNvbnN0IGlucHV0Qmx1cnJpbmcgPSBjb25maWcuZ2V0Qm9vbGVhbignaW5wdXRCbHVycmluZycsIGlzSU9TKTtcbiAgY29uc3Qgc2Nyb2xsUGFkZGluZyA9IGNvbmZpZy5nZXRCb29sZWFuKCdzY3JvbGxQYWRkaW5nJywgdHJ1ZSk7XG4gIGNvbnN0IGlucHV0cyA9IEFycmF5LmZyb20oZG9jLnF1ZXJ5U2VsZWN0b3JBbGwoJ2lvbi1pbnB1dCwgaW9uLXRleHRhcmVhJykpO1xuICBjb25zdCBoaWRlQ2FyZXRNYXAgPSBuZXcgV2Vha01hcCgpO1xuICBjb25zdCBzY3JvbGxBc3Npc3RNYXAgPSBuZXcgV2Vha01hcCgpO1xuICAvKipcbiAgICogR3JhYiB0aGUgbmF0aXZlIGtleWJvYXJkIHJlc2l6ZSBjb25maWd1cmF0aW9uXG4gICAqIGFuZCBwYXNzIGl0IHRvIHNjcm9sbCBhc3Npc3QuIFNjcm9sbCBhc3Npc3QgcmVxdWlyZXNcbiAgICogdGhhdCB3ZSBhZGp1c3QgdGhlIGlucHV0IHJpZ2h0IGJlZm9yZSB0aGUgaW5wdXRcbiAgICogaXMgYWJvdXQgdG8gYmUgZm9jdXNlZC4gSWYgd2UgY2FsbGVkIGBLZXlib2FyZC5nZXRSZXNpemVNb2RlYFxuICAgKiBvbiBmb2N1c2luIGluIHNjcm9sbCBhc3Npc3QsIHdlIGNvdWxkIHBvdGVudGlhbGx5IGFkanVzdCB0aGVcbiAgICogaW5wdXQgdG9vIGxhdGUgc2luY2UgdGhpcyBjYWxsIGlzIGFzeW5jLlxuICAgKi9cbiAgY29uc3Qga2V5Ym9hcmRSZXNpemVNb2RlID0gYXdhaXQgS2V5Ym9hcmQuZ2V0UmVzaXplTW9kZSgpO1xuICBjb25zdCByZWdpc3RlcklucHV0ID0gYXN5bmMgKGNvbXBvbmVudEVsKSA9PiB7XG4gICAgYXdhaXQgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IGNvbXBvbmVudE9uUmVhZHkoY29tcG9uZW50RWwsIHJlc29sdmUpKTtcbiAgICBjb25zdCBpbnB1dFJvb3QgPSBjb21wb25lbnRFbC5zaGFkb3dSb290IHx8IGNvbXBvbmVudEVsO1xuICAgIGNvbnN0IGlucHV0RWwgPSBpbnB1dFJvb3QucXVlcnlTZWxlY3RvcignaW5wdXQnKSB8fCBpbnB1dFJvb3QucXVlcnlTZWxlY3RvcigndGV4dGFyZWEnKTtcbiAgICBjb25zdCBzY3JvbGxFbCA9IGZpbmRDbG9zZXN0SW9uQ29udGVudChjb21wb25lbnRFbCk7XG4gICAgY29uc3QgZm9vdGVyRWwgPSAhc2Nyb2xsRWwgPyBjb21wb25lbnRFbC5jbG9zZXN0KCdpb24tZm9vdGVyJykgOiBudWxsO1xuICAgIGlmICghaW5wdXRFbCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoISFzY3JvbGxFbCAmJiBoaWRlQ2FyZXQgJiYgIWhpZGVDYXJldE1hcC5oYXMoY29tcG9uZW50RWwpKSB7XG4gICAgICBjb25zdCBybUZuID0gZW5hYmxlSGlkZUNhcmV0T25TY3JvbGwoY29tcG9uZW50RWwsIGlucHV0RWwsIHNjcm9sbEVsKTtcbiAgICAgIGhpZGVDYXJldE1hcC5zZXQoY29tcG9uZW50RWwsIHJtRm4pO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBkYXRlL2RhdGV0aW1lLWxvY2FsZSBpbnB1dHMgb24gbW9iaWxlIGRldmljZXMgc2hvdyBkYXRlIHBpY2tlclxuICAgICAqIG92ZXJsYXlzIGluc3RlYWQgb2Yga2V5Ym9hcmRzLiBBcyBhIHJlc3VsdCwgc2Nyb2xsIGFzc2lzdCBpc1xuICAgICAqIG5vdCBuZWVkZWQuIFRoaXMgYWxzbyB3b3JrcyBhcm91bmQgYSBidWcgaW4gaU9TIDwxNiB3aGVyZVxuICAgICAqIHNjcm9sbCBhc3Npc3QgY2F1c2VzIHRoZSBicm93c2VyIHRvIGxvY2sgdXAuIFNlZSBGVy0xOTk3LlxuICAgICAqL1xuICAgIGNvbnN0IGlzRGF0ZUlucHV0ID0gaW5wdXRFbC50eXBlID09PSAnZGF0ZScgfHwgaW5wdXRFbC50eXBlID09PSAnZGF0ZXRpbWUtbG9jYWwnO1xuICAgIGlmICghaXNEYXRlSW5wdXQgJiZcbiAgICAgICghIXNjcm9sbEVsIHx8ICEhZm9vdGVyRWwpICYmXG4gICAgICBzY3JvbGxBc3Npc3QgJiZcbiAgICAgICFzY3JvbGxBc3Npc3RNYXAuaGFzKGNvbXBvbmVudEVsKSkge1xuICAgICAgY29uc3Qgcm1GbiA9IGVuYWJsZVNjcm9sbEFzc2lzdChjb21wb25lbnRFbCwgaW5wdXRFbCwgc2Nyb2xsRWwsIGZvb3RlckVsLCBrZXlib2FyZEhlaWdodCwgc2Nyb2xsUGFkZGluZywga2V5Ym9hcmRSZXNpemVNb2RlLCBpc0FuZHJvaWQpO1xuICAgICAgc2Nyb2xsQXNzaXN0TWFwLnNldChjb21wb25lbnRFbCwgcm1Gbik7XG4gICAgfVxuICB9O1xuICBjb25zdCB1bnJlZ2lzdGVySW5wdXQgPSAoY29tcG9uZW50RWwpID0+IHtcbiAgICBpZiAoaGlkZUNhcmV0KSB7XG4gICAgICBjb25zdCBmbiA9IGhpZGVDYXJldE1hcC5nZXQoY29tcG9uZW50RWwpO1xuICAgICAgaWYgKGZuKSB7XG4gICAgICAgIGZuKCk7XG4gICAgICB9XG4gICAgICBoaWRlQ2FyZXRNYXAuZGVsZXRlKGNvbXBvbmVudEVsKTtcbiAgICB9XG4gICAgaWYgKHNjcm9sbEFzc2lzdCkge1xuICAgICAgY29uc3QgZm4gPSBzY3JvbGxBc3Npc3RNYXAuZ2V0KGNvbXBvbmVudEVsKTtcbiAgICAgIGlmIChmbikge1xuICAgICAgICBmbigpO1xuICAgICAgfVxuICAgICAgc2Nyb2xsQXNzaXN0TWFwLmRlbGV0ZShjb21wb25lbnRFbCk7XG4gICAgfVxuICB9O1xuICBpZiAoaW5wdXRCbHVycmluZyAmJiBJTlBVVF9CTFVSUklORykge1xuICAgIGVuYWJsZUlucHV0Qmx1cnJpbmcoKTtcbiAgfVxuICAvLyBJbnB1dCBtaWdodCBiZSBhbHJlYWR5IGxvYWRlZCBpbiB0aGUgRE9NIGJlZm9yZSBpb24tZGV2aWNlLWhhY2tzIGRpZC5cbiAgLy8gQXQgdGhpcyBwb2ludCB3ZSBuZWVkIHRvIGxvb2sgZm9yIGFsbCBvZiB0aGUgaW5wdXRzIG5vdCByZWdpc3RlcmVkIHlldFxuICAvLyBhbmQgcmVnaXN0ZXIgdGhlbS5cbiAgZm9yIChjb25zdCBpbnB1dCBvZiBpbnB1dHMpIHtcbiAgICByZWdpc3RlcklucHV0KGlucHV0KTtcbiAgfVxuICAvLyBUT0RPKEZXLTI4MzIpOiB0eXBlc1xuICBkb2MuYWRkRXZlbnRMaXN0ZW5lcignaW9uSW5wdXREaWRMb2FkJywgKChldikgPT4ge1xuICAgIHJlZ2lzdGVySW5wdXQoZXYuZGV0YWlsKTtcbiAgfSkpO1xuICBkb2MuYWRkRXZlbnRMaXN0ZW5lcignaW9uSW5wdXREaWRVbmxvYWQnLCAoKGV2KSA9PiB7XG4gICAgdW5yZWdpc3RlcklucHV0KGV2LmRldGFpbCk7XG4gIH0pKTtcbn07XG5cbmV4cG9ydCB7IHN0YXJ0SW5wdXRTaGltcyB9O1xuIl0sIm5hbWVzIjpbIktleWJvYXJkUmVzaXplIiwiS2V5Ym9hcmQiLCJnZXRFbmdpbmUiLCJfYSIsIndpbiIsImlzUGx1Z2luQXZhaWxhYmxlIiwiZ2V0UmVzaXplTW9kZSIsImVuZ2luZSIsInRoaXMiLCJQcm9taXNlIiwicmVzb2x2ZSIsInVuZGVmaW5lZCIsImNsb25lTWFwIiwiV2Vha01hcCIsInJlbG9jYXRlSW5wdXQiLCJjb21wb25lbnRFbCIsImlucHV0RWwiLCJzaG91bGRSZWxvY2F0ZSIsImlucHV0UmVsYXRpdmVZIiwiYXJndW1lbnRzIiwibGVuZ3RoIiwiZGlzYWJsZWRDbG9uZWRJbnB1dCIsImhhcyIsImFkZENsb25lIiwicmVtb3ZlQ2xvbmUiLCJwYXJlbnRFbCIsInBhcmVudE5vZGUiLCJjbG9uZWRFbCIsImNsb25lTm9kZSIsImNsYXNzTGlzdCIsImFkZCIsInRhYkluZGV4IiwiZGlzYWJsZWQiLCJhcHBlbmRDaGlsZCIsInNldCIsInR4Iiwib3duZXJEb2N1bWVudCIsImRpciIsInN0eWxlIiwicG9pbnRlckV2ZW50cyIsInRyYW5zZm9ybSIsImNsb25lIiwiZ2V0IiwiZGVsZXRlIiwicmVtb3ZlIiwiU0tJUF9TRUxFQ1RPUiIsImNhbGNTY3JvbGxEYXRhIiwiaW5wdXRSZWN0IiwiY29udGVudFJlY3QiLCJrZXlib2FyZEhlaWdodCIsInBsYXRmb3JtSGVpZ2h0IiwiaW5wdXRUb3AiLCJ0b3AiLCJpbnB1dEJvdHRvbSIsImJvdHRvbSIsInZpc2libGVBcmVhVG9wIiwic2FmZUFyZWFUb3AiLCJkaXN0YW5jZVRvQm90dG9tIiwiTWF0aCIsIm1pbiIsImRpc3RhbmNlVG9Ub3AiLCJkZXNpcmVkU2Nyb2xsQW1vdW50Iiwicm91bmQiLCJzY3JvbGxBbW91bnQiLCJkdXJhdGlvbiIsImFicyIsInNjcm9sbER1cmF0aW9uIiwibWF4Iiwic2Nyb2xsUGFkZGluZyIsImlucHV0U2FmZVkiLCJQQURESU5HX1RJTUVSX0tFWSIsInNldFNjcm9sbFBhZGRpbmciLCJjb250ZW50RWwiLCJwYWRkaW5nQW1vdW50IiwiY2xlYXJDYWxsYmFjayIsInRpbWVyIiwiY2xlYXJUaW1lb3V0Iiwic2V0UHJvcGVydHkiLCJzZXRUaW1lb3V0Iiwic2V0Q2xlYXJTY3JvbGxQYWRkaW5nTGlzdGVuZXIiLCJkb25lQ2FsbGJhY2siLCJhZGRFdmVudExpc3RlbmVyIiwiY2xlYXJTY3JvbGxQYWRkaW5nIiwib25jZSIsImN1cnJlbnRQYWRkaW5nIiwianNTZXRGb2N1cyIsImFzeW5jIiwiZm9vdGVyRWwiLCJlbmFibGVTY3JvbGxQYWRkaW5nIiwiZGlzYWJsZUNsb25lZElucHV0Iiwic2Nyb2xsRGF0YSIsImdldFNjcm9sbERhdGEiLCJpdGVtRWwiLCJjbG9zZXN0IiwiZ2V0Qm91bmRpbmdDbGllbnRSZWN0IiwiZGVmYXVsdFZpZXciLCJpbm5lckhlaWdodCIsImZvY3VzIiwicmFmIiwiY2xpY2siLCJ3aW5kb3ciLCJzY3JvbGxDb250ZW50VGltZW91dCIsInNjcm9sbENvbnRlbnQiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiZG91YmxlS2V5Ym9hcmRFdmVudExpc3RlbmVyIiwic2Nyb2xsQnlQb2ludCIsInNjcm9sbEVsIiwiZ2V0U2Nyb2xsRWxlbWVudCIsInRvdGFsU2Nyb2xsQW1vdW50Iiwic2Nyb2xsSGVpZ2h0IiwiY2xpZW50SGVpZ2h0Iiwic2Nyb2xsVG9wIiwidHlwZSIsInN0YXJ0SW5wdXRTaGltcyIsImNvbmZpZyIsInBsYXRmb3JtIiwiZG9jIiwiZG9jdW1lbnQiLCJpc0lPUyIsImlzQW5kcm9pZCIsImdldE51bWJlciIsInNjcm9sbEFzc2lzdCIsImdldEJvb2xlYW4iLCJoaWRlQ2FyZXQiLCJpbnB1dEJsdXJyaW5nIiwiaW5wdXRzIiwiQXJyYXkiLCJmcm9tIiwicXVlcnlTZWxlY3RvckFsbCIsImhpZGVDYXJldE1hcCIsInNjcm9sbEFzc2lzdE1hcCIsImtleWJvYXJkUmVzaXplTW9kZSIsInJlZ2lzdGVySW5wdXQiLCJjb21wb25lbnRPblJlYWR5IiwiaW5wdXRSb290Iiwic2hhZG93Um9vdCIsInF1ZXJ5U2VsZWN0b3IiLCJmaW5kQ2xvc2VzdElvbkNvbnRlbnQiLCJybUZuIiwiZW5hYmxlSGlkZUNhcmV0T25TY3JvbGwiLCJzY3JvbGxIaWRlQ2FyZXQiLCJzaG91bGRIaWRlQ2FyZXQiLCJpbnB1dCIsImdldFJvb3ROb2RlIiwiYWN0aXZlRWxlbWVudCIsIm9uQmx1ciIsInNob3dDYXJldCIsImtleWJvYXJkUmVzaXplIiwiYWRkU2Nyb2xsUGFkZGluZyIsIm1vZGUiLCJOb25lIiwiZm9jdXNJbiIsImVuYWJsZVNjcm9sbEFzc2lzdCIsImVuYWJsZUlucHV0Qmx1cnJpbmciLCJmb2N1c2VkIiwiZGlkU2Nyb2xsIiwib25TY3JvbGwiLCJvbkZvY3VzaW4iLCJvblRvdWNoZW5kIiwiZXYiLCJhY3RpdmUiLCJtYXRjaGVzIiwidGFwcGVkIiwidGFyZ2V0IiwiYmx1ciIsImRldGFpbCIsImZuIiwidW5yZWdpc3RlcklucHV0Il0sInNvdXJjZVJvb3QiOiIifQ==