{"ast":null,"code":"// Inspired by useLocalStorage from https://usehooks.com/useLocalStorage/\nimport { useState, useEffect, useCallback } from 'react';\nimport { Plugins } from '@capacitor/core';\nimport { notAvailable } from '../util/models';\nimport { isFeatureAvailable, featureNotAvailableError } from '../util/feature-check';\nexport const availableFeatures = {\n  useStorage: isFeatureAvailable('Storage', 'useStorage')\n};\nexport function useStorage() {\n  const {\n    Storage\n  } = Plugins;\n  if (!availableFeatures.useStorage) {\n    return Object.assign({\n      get: featureNotAvailableError,\n      set: featureNotAvailableError,\n      remove: featureNotAvailableError,\n      getKeys: featureNotAvailableError,\n      clear: featureNotAvailableError\n    }, notAvailable);\n  }\n  const get = useCallback(async key => {\n    const v = await Storage.get({\n      key\n    });\n    if (v) {\n      return v.value;\n    }\n    return null;\n  }, []);\n  const set = useCallback((key, value) => {\n    return Storage.set({\n      key,\n      value: value\n    });\n  }, []);\n  const remove = useCallback(key => {\n    return Storage.remove({\n      key\n    });\n  }, []);\n  const getKeys = useCallback(() => {\n    return Storage.keys();\n  }, []);\n  const clear = useCallback(() => {\n    return Storage.clear();\n  }, []);\n  return {\n    get,\n    set,\n    remove,\n    getKeys,\n    clear,\n    isAvailable: true\n  };\n}\nexport function useStorageItem(key, initialValue) {\n  const {\n    Storage\n  } = Plugins;\n  if (!availableFeatures.useStorage) {\n    return [undefined, featureNotAvailableError, false];\n  }\n  const [storedValue, setStoredValue] = useState();\n  useEffect(() => {\n    async function loadValue() {\n      try {\n        const result = await Storage.get({\n          key\n        });\n        if (result.value == undefined && initialValue != undefined) {\n          result.value = typeof initialValue === \"string\" ? initialValue : JSON.stringify(initialValue);\n          setValue(result.value);\n        } else {\n          setStoredValue(typeof result.value === 'string' ? result.value : JSON.parse(result.value));\n        }\n      } catch (e) {\n        return initialValue;\n      }\n    }\n    loadValue();\n  }, [Storage, setStoredValue, initialValue, key]);\n  const setValue = async value => {\n    try {\n      setStoredValue(value);\n      await Storage.set({\n        key,\n        value: typeof value === \"string\" ? value : JSON.stringify(value)\n      });\n    } catch (e) {\n      console.error(e);\n    }\n  };\n  return [storedValue, setValue, true];\n}","map":{"version":3,"names":["useState","useEffect","useCallback","Plugins","notAvailable","isFeatureAvailable","featureNotAvailableError","availableFeatures","useStorage","Storage","Object","assign","get","set","remove","getKeys","clear","key","v","value","keys","isAvailable","useStorageItem","initialValue","undefined","storedValue","setStoredValue","loadValue","result","JSON","stringify","setValue","parse","e","console","error"],"sources":["../../src/storage/useStorage.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}